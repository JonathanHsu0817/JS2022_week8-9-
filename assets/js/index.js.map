{"version":3,"sources":["index.js"],"names":["productData","cartData","productList","document","querySelector","productSelect","init","getProductList","getCartList","axios","get","api_path","then","res","data","products","renderCard","str","forEach","item","content","images","id","title","toThousandsComma","origin_price","price","innerHTML","addEventListener","e","category","target","value","tempData","push","preventDefault","addCartClass","getAttribute","productId","console","log","numberCheck","product","quantity","post","alert","finalTotal","textContent","carts","renderCart","cartList","cartId","discardAllBtn","err","orderForm","orderInfoBtn","length","customerName","customerPhone","customerEmail","customerAddress","customerTradeWay","reset","inputs","querySelectorAll","constraints","presence","message","minimum","email","nextElementSibling","errors","validate","Object","keys","num","toString","replace"],"mappings":";;AAAA;AACA,IAAIA,WAAW,GAAG,EAAlB;AACA,IAAIC,QAAQ,GAAG,EAAf;AACA,IAAMC,WAAW,GAAGC,QAAQ,CAACC,aAAT,CAAuB,cAAvB,CAApB;AACA,IAAMC,aAAa,GAAGF,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAAtB;;AAEA,SAASE,IAAT,GAAe;AACXC,EAAAA,cAAc;AACdC,EAAAA,WAAW;AACd;;AAAA,C,CAGD;;AACA,SAASD,cAAT,GAAyB;AACrBE,EAAAA,KAAK,CAACC,GAAN,kEAAoEC,QAApE,gBACGC,IADH,CACQ,UAAAC,GAAG,EAAE;AACT;AACAb,IAAAA,WAAW,GAAGa,GAAG,CAACC,IAAJ,CAASC,QAAvB;AACAC,IAAAA,UAAU,CAAChB,WAAD,CAAV;AACD,GALH;AAMH;;AAAA,C,CAED;;AACA,SAASgB,UAAT,CAAoBF,IAApB,EAAyB;AACrB,MAAIG,GAAG,GAAG,EAAV;AACAH,EAAAA,IAAI,CAACI,OAAL,CAAa,UAAAC,IAAI,EAAE;AACf,QAAIC,OAAO,yHAEKD,IAAI,CAACE,MAFV,oFAGmCF,IAAI,CAACG,EAHxC,oEAIDH,IAAI,CAACI,KAJJ,8DAKuBC,gBAAgB,CAACL,IAAI,CAACM,YAAN,CALvC,0DAMkBD,gBAAgB,CAACL,IAAI,CAACO,KAAN,CANlC,wBAAX;AAQAT,IAAAA,GAAG,IAAEG,OAAL;AACH,GAVD;AAWAlB,EAAAA,WAAW,CAACyB,SAAZ,GAAwBV,GAAxB;AACH,C,CAED;;;AACAZ,aAAa,CAACuB,gBAAd,CAA+B,QAA/B,EAAwC,UAACC,CAAD,EAAK;AACzC;AACA,MAAMC,QAAQ,GAAGD,CAAC,CAACE,MAAF,CAASC,KAA1B;;AACA,MAAIF,QAAQ,KAAK,IAAjB,EAAsB;AAClBd,IAAAA,UAAU,CAAChB,WAAD,CAAV;AACH,GAFD,MAEK;AACD,QAAMiC,QAAQ,GAAG,EAAjB;AACAjC,IAAAA,WAAW,CAACkB,OAAZ,CAAoB,UAAAC,IAAI,EAAE;AACtB,UAAGA,IAAI,CAACW,QAAL,KAAkBA,QAArB,EAA8B;AAC1BG,QAAAA,QAAQ,CAACC,IAAT,CAAcf,IAAd;AACH;AACJ,KAJD;AAKAH,IAAAA,UAAU,CAACiB,QAAD,CAAV;AACH;AACJ,CAdD,E,CAiBA;AACA;;AACA/B,WAAW,CAAC0B,gBAAZ,CAA6B,OAA7B,EAAqC,UAACC,CAAD,EAAK;AACtCA,EAAAA,CAAC,CAACM,cAAF;AACA,MAAIC,YAAY,GAAGP,CAAC,CAACE,MAAF,CAASM,YAAT,CAAsB,OAAtB,CAAnB;;AACA,MAAGD,YAAY,KAAK,YAApB,EAAiC;AAC7B;AACH;;AACD,MAAIE,SAAS,GAAGT,CAAC,CAACE,MAAF,CAASM,YAAT,CAAsB,SAAtB,CAAhB,CANsC,CAMW;;AACjDE,EAAAA,OAAO,CAACC,GAAR,CAAYF,SAAZ;AAEA,MAAIG,WAAW,GAAG,CAAlB;AACAF,EAAAA,OAAO,CAACC,GAAR,CAAYvC,QAAZ;AACAA,EAAAA,QAAQ,CAACiB,OAAT,CAAiB,UAAAC,IAAI,EAAG;AACpB,QAAGmB,SAAS,KAAKnB,IAAI,CAACuB,OAAL,CAAapB,EAA9B,EAAiC;AAC7BmB,MAAAA,WAAW,GAACtB,IAAI,CAACwB,QAAL,GAAc,CAA1B;AACH;AACJ,GAJD;AAKAJ,EAAAA,OAAO,CAACC,GAAR,CAAYC,WAAZ,EAhBsC,CAiBtC;;AACAhC,EAAAA,KAAK,CAACmC,IAAN,kEAAqEjC,QAArE,aAAsF;AAClF,YAAQ;AACJ,mBAAa2B,SADT;AAEJ,kBAAYG;AAFR;AAD0E,GAAtF,EAKG7B,IALH,CAKQ,UAAAC,GAAG,EAAE;AACL;AACAgC,IAAAA,KAAK,CAAC,MAAD,CAAL;AACArC,IAAAA,WAAW;AACd,GATL;AAUH,CA5BD,E,CA8BA;;AACA,SAASA,WAAT,GAAsB;AAClBC,EAAAA,KAAK,CAACC,GAAN,kEAAoEC,QAApE,aACKC,IADL,CACU,UAAAC,GAAG,EAAE;AACP;AACA,QAAIiC,UAAU,GAAGjC,GAAG,CAACC,IAAJ,CAASgC,UAA1B;AACA3C,IAAAA,QAAQ,CAACC,aAAT,CAAuB,WAAvB,EAAoC2C,WAApC,GAAkDvB,gBAAgB,CAACsB,UAAD,CAAlE;AACA7C,IAAAA,QAAQ,GAAGY,GAAG,CAACC,IAAJ,CAASkC,KAApB,CAJO,CAKP;;AACAC,IAAAA,UAAU,CAAChD,QAAD,CAAV;AACH,GARL;AASH;;AAED,IAAMiD,QAAQ,GAAG/C,QAAQ,CAACC,aAAT,CAAuB,yBAAvB,CAAjB;;AAEA,SAAS6C,UAAT,CAAoBnC,IAApB,EAAyB;AACrB,MAAIG,GAAG,GAAG,EAAV;AACAH,EAAAA,IAAI,CAACI,OAAL,CAAa,UAAAC,IAAI,EAAE;AACf,QAAIC,OAAO,oHAGaD,IAAI,CAACuB,OAAL,CAAarB,MAH1B,kDAIMF,IAAI,CAACuB,OAAL,CAAanB,KAJnB,+EAOAC,gBAAgB,CAACL,IAAI,CAACuB,OAAL,CAAahB,KAAd,CAPhB,oCAQDP,IAAI,CAACwB,QARJ,qCASAnB,gBAAgB,CAACL,IAAI,CAACuB,OAAL,CAAahB,KAAb,GAAqBP,IAAI,CAACwB,QAA3B,CAThB,4HAW2CxB,IAAI,CAACG,EAXhD,2FAAX;AAgBAL,IAAAA,GAAG,IAAEG,OAAL;AACH,GAlBD;AAmBA8B,EAAAA,QAAQ,CAACvB,SAAT,GAAqBV,GAArB;AACH,C,CAED;;;AACAiC,QAAQ,CAACtB,gBAAT,CAA0B,OAA1B,EAAkC,UAACC,CAAD,EAAK;AACnCA,EAAAA,CAAC,CAACM,cAAF,GADmC,CAEnC;;AACA,MAAMgB,MAAM,GAAGtB,CAAC,CAACE,MAAF,CAASM,YAAT,CAAsB,SAAtB,CAAf;;AACA,MAAGc,MAAM,IAAI,IAAb,EAAkB;AACd;AACH,GANkC,CAOnC;;;AAEA1C,EAAAA,KAAK,UAAL,kEAAuEE,QAAvE,oBAAyFwC,MAAzF,GACKvC,IADL,CACU,UAAAC,GAAG,EAAE;AACPgC,IAAAA,KAAK,CAAC,MAAD,CAAL;AACArC,IAAAA,WAAW;AACd,GAJL;AAKH,CAdD,E,CAgBA;;AACA,IAAM4C,aAAa,GAAGjD,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAAtB;AAEAgD,aAAa,CAACxB,gBAAd,CAA+B,OAA/B,EAAuC,UAACC,CAAD,EAAK;AACxCA,EAAAA,CAAC,CAACM,cAAF;AACA1B,EAAAA,KAAK,UAAL,kEAAuEE,QAAvE,aACKC,IADL,CACU,UAAAC,GAAG,EAAE;AACPgC,IAAAA,KAAK,CAAC,QAAD,CAAL;AACArC,IAAAA,WAAW;AACd,GAJL,WAKW,UAAA6C,GAAG,EAAE;AACRR,IAAAA,KAAK,CAAC,YAAD,CAAL;AACArC,IAAAA,WAAW;AACd,GARL;AASH,CAXD;AAaAF,IAAI,G,CAEJ;;AACA,IAAMgD,SAAS,GAAGnD,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAAlB;AACA,IAAMmD,YAAY,GAAGpD,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAArB;AACAmD,YAAY,CAAC3B,gBAAb,CAA8B,OAA9B,EAAsC,UAACC,CAAD,EAAK;AACvCA,EAAAA,CAAC,CAACM,cAAF,GADuC,CAEvC;;AACA,MAAGlC,QAAQ,CAACuD,MAAT,IAAkB,CAArB,EAAuB;AACnBX,IAAAA,KAAK,CAAC,QAAD,CAAL;AACA;AACH;;AAED,MAAMY,YAAY,GAAGtD,QAAQ,CAACC,aAAT,CAAuB,eAAvB,EAAwC4B,KAA7D;AACA,MAAM0B,aAAa,GAAGvD,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,EAAyC4B,KAA/D;AACA,MAAM2B,aAAa,GAAGxD,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,EAAyC4B,KAA/D;AACA,MAAM4B,eAAe,GAAGzD,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,EAA2C4B,KAAnE;AACA,MAAM6B,gBAAgB,GAAG1D,QAAQ,CAACC,aAAT,CAAuB,WAAvB,EAAoC4B,KAA7D;;AACA,MAAGyB,YAAY,IAAE,EAAd,IAAkBG,eAAe,IAAE,EAAnC,IAAuCF,aAAa,IAAE,EAAtD,IAA0DC,aAAa,IAAE,EAAzE,IAA6EE,gBAAgB,IAAE,EAAlG,EAAqG;AACjGhB,IAAAA,KAAK,CAAC,SAAD,CAAL;AACA;AACH;;AAEDpC,EAAAA,KAAK,CAACmC,IAAN,kEAAqEjC,QAArE,cAAuF;AACnF,YAAQ;AACJ,cAAQ;AACR,gBAAQ8C,YADA;AAER,eAAOC,aAFC;AAGR,iBAASC,aAHD;AAIR,mBAAWC,eAJH;AAKR,mBAAWC;AALH;AADJ;AAD2E,GAAvF,EAUGjD,IAVH,CAUQ,UAAAC,GAAG,EAAE;AACTgC,IAAAA,KAAK,CAAC,QAAD,CAAL;AACAS,IAAAA,SAAS,CAACQ,KAAV;AACAtD,IAAAA,WAAW;AACd,GAdD;AAeH,CAjCD,E,CAkCA;;AACA,IAAMuD,MAAM,GAAG5D,QAAQ,CAAC6D,gBAAT,CAA0B,kCAA1B,CAAf;AAEA,IAAMC,WAAW,GAAG;AAChB,QAAM;AACJC,IAAAA,QAAQ,EAAE;AACRC,MAAAA,OAAO,EAAE;AADD;AADN,GADU;AAMhB,QAAM;AACJD,IAAAA,QAAQ,EAAE;AACRC,MAAAA,OAAO,EAAE;AADD,KADN;AAIJX,IAAAA,MAAM,EAAE;AACNY,MAAAA,OAAO,EAAE,CADH;AAEND,MAAAA,OAAO,EAAE;AAFH;AAJJ,GANU;AAehB,WAAS;AACPD,IAAAA,QAAQ,EAAE;AACRC,MAAAA,OAAO,EAAE;AADD,KADH;AAIPE,IAAAA,KAAK,EAAE;AACLF,MAAAA,OAAO,EAAE;AADJ;AAJA,GAfO;AAuBhB,UAAQ;AACND,IAAAA,QAAQ,EAAE;AACRC,MAAAA,OAAO,EAAE;AADD;AADJ,GAvBQ;AA4BhB,UAAQ;AACND,IAAAA,QAAQ,EAAE;AACRC,MAAAA,OAAO,EAAE;AADD;AADJ;AA5BQ,CAApB;AAmCEJ,MAAM,CAAC7C,OAAP,CAAe,UAACC,IAAD,EAAU;AACvBA,EAAAA,IAAI,CAACS,gBAAL,CAAsB,QAAtB,EAAgC,YAAY;AAE1CT,IAAAA,IAAI,CAACmD,kBAAL,CAAwBvB,WAAxB,GAAsC,EAAtC;AACA,QAAIwB,MAAM,GAAGC,QAAQ,CAAClB,SAAD,EAAYW,WAAZ,CAAR,IAAoC,EAAjD;AACA1B,IAAAA,OAAO,CAACC,GAAR,CAAY+B,MAAZ;;AAEA,QAAIA,MAAJ,EAAY;AACVE,MAAAA,MAAM,CAACC,IAAP,CAAYH,MAAZ,EAAoBrD,OAApB,CAA4B,UAAUwD,IAAV,EAAgB;AAC1CnC,QAAAA,OAAO,CAACC,GAAR,CAAYrC,QAAQ,CAACC,aAAT,yBAAwCsE,IAAxC,OAAZ;AACAvE,QAAAA,QAAQ,CAACC,aAAT,2BAAyCsE,IAAzC,UAAmD3B,WAAnD,GAAiEwB,MAAM,CAACG,IAAD,CAAvE;AACD,OAHD;AAID;AACF,GAZD;AAaD,CAdD,E,CAgBF;;AACA,SAASlD,gBAAT,CAA0BmD,GAA1B,EAA8B;AAC1B,SAAOA,GAAG,CAACC,QAAJ,GAAeC,OAAf,CAAuB,uBAAvB,EAAgD,GAAhD,CAAP;AACH","sourcesContent":["////index section\r\nlet productData = [];\r\nlet cartData = [];\r\nconst productList = document.querySelector(\".productWrap\");\r\nconst productSelect = document.querySelector(\".productSelect\");\r\n\r\nfunction init(){\r\n    getProductList();\r\n    getCartList();\r\n};\r\n\r\n\r\n//取product api裡資料\r\nfunction getProductList(){\r\n    axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/products`)\r\n      .then(res=>{\r\n        // console.log(res.data);\r\n        productData = res.data.products;\r\n        renderCard(productData);\r\n      })\r\n};\r\n\r\n//將product api資料渲染成HTML(card)\r\nfunction renderCard(data){\r\n    let str = \"\";\r\n    data.forEach(item=>{\r\n        let content = `<li class=\"productCard\">\r\n            <h4 class=\"productType\">新品</h4>\r\n            <img src=\"${item.images}\" alt=\"\">\r\n            <a href=\"#\" class=\"js-addCart\" data-id=\"${item.id}\">加入購物車</a>\r\n            <h3>${item.title}</h3>\r\n            <del class=\"originPrice\">NT$${toThousandsComma(item.origin_price)}</del>\r\n            <p class=\"nowPrice\">NT$${toThousandsComma(item.price)}</p>\r\n        </li>`\r\n        str+=content;\r\n    })\r\n    productList.innerHTML = str;\r\n}\r\n\r\n//篩選category\r\nproductSelect.addEventListener(\"change\",(e)=>{\r\n    // console.log(e.target.value);\r\n    const category = e.target.value;\r\n    if( category === \"全部\"){\r\n        renderCard(productData)\r\n    }else{\r\n        const tempData = [];\r\n        productData.forEach(item=>{\r\n            if(item.category === category){\r\n                tempData.push(item)\r\n            }\r\n        })\r\n        renderCard(tempData);\r\n    }\r\n})\r\n\r\n\r\n////購物車\r\n//點選購物車\r\nproductList.addEventListener(\"click\",(e)=>{\r\n    e.preventDefault();\r\n    let addCartClass = e.target.getAttribute(\"class\");\r\n    if(addCartClass !== \"js-addCart\"){\r\n        return;\r\n    }\r\n    let productId = e.target.getAttribute(\"data-id\");//e.target.dataset.id\r\n    console.log(productId)\r\n\r\n    let numberCheck = 1;\r\n    console.log(cartData)\r\n    cartData.forEach(item =>{\r\n        if(productId === item.product.id){\r\n            numberCheck=item.quantity+1;\r\n        }\r\n    })\r\n    console.log(numberCheck);\r\n    // 加入購物車 數量 並輸入給api\r\n    axios.post(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/carts`,{\r\n        \"data\": {\r\n            \"productId\": productId,\r\n            \"quantity\": numberCheck\r\n          }\r\n    }).then(res=>{\r\n            // console.log(res)\r\n            alert(\"加入成功\")\r\n            getCartList();\r\n        })\r\n})\r\n\r\n//取購物車api\r\nfunction getCartList(){\r\n    axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/carts`)\r\n        .then(res=>{\r\n            // console.log(res.data);\r\n            let finalTotal = res.data.finalTotal;\r\n            document.querySelector(\".js-total\").textContent = toThousandsComma(finalTotal);\r\n            cartData = res.data.carts;\r\n            // console.log(cartData);\r\n            renderCart(cartData);\r\n        })\r\n}\r\n\r\nconst cartList = document.querySelector(\".shoppingCart-tableList\");\r\n\r\nfunction renderCart(data){\r\n    let str = '';\r\n    data.forEach(item=>{\r\n        let content = `<tr>\r\n            <td>\r\n                <div class=\"cardItem-title\">\r\n                    <img src=\"${item.product.images}\" alt=\"\">\r\n                    <p>${item.product.title}</p>\r\n                </div>\r\n            </td>\r\n            <td>$${toThousandsComma(item.product.price)}</td>\r\n            <td>${item.quantity}</td>\r\n            <td>$${toThousandsComma(item.product.price * item.quantity)}</td>\r\n            <td class=\"discardBtn\">\r\n                <a href=\"#\" class=\"material-icons\" data-id=\"${item.id}\">\r\n                    clear\r\n                </a>\r\n            </td>\r\n        </tr>`\r\n        str+=content;\r\n    })\r\n    cartList.innerHTML = str;\r\n}\r\n\r\n//刪除購物車單一品項\r\ncartList.addEventListener('click',(e)=>{\r\n    e.preventDefault();\r\n    // console.log(e.target)\r\n    const cartId = e.target.getAttribute('data-id');\r\n    if(cartId == null){\r\n        return;\r\n    }\r\n    // console.log(cartId)\r\n\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/carts/${cartId}`)\r\n        .then(res=>{\r\n            alert(\"刪除成功\")\r\n            getCartList()\r\n        })\r\n})\r\n\r\n//刪除整個購物車\r\nconst discardAllBtn = document.querySelector(\".discardAllBtn\");\r\n\r\ndiscardAllBtn.addEventListener('click',(e)=>{\r\n    e.preventDefault();\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/carts`)\r\n        .then(res=>{\r\n            alert(\"全部刪除成功\")\r\n            getCartList();\r\n        })\r\n        .catch(err=>{\r\n            alert(\"已清空，請勿重複刪除\")\r\n            getCartList();\r\n        })\r\n})\r\n\r\ninit();\r\n\r\n////加入預定訂單\r\nconst orderForm = document.querySelector(\".orderInfo-form\");\r\nconst orderInfoBtn = document.querySelector(\".orderInfo-btn\");\r\norderInfoBtn.addEventListener(\"click\",(e)=>{\r\n    e.preventDefault();\r\n    // console.log(e.target)\r\n    if(cartData.length ==0){\r\n        alert(\"請加入購物車\");\r\n        return;\r\n    }\r\n\r\n    const customerName = document.querySelector(\"#customerName\").value;\r\n    const customerPhone = document.querySelector(\"#customerPhone\").value;\r\n    const customerEmail = document.querySelector(\"#customerEmail\").value;\r\n    const customerAddress = document.querySelector(\"#customerAddress\").value;\r\n    const customerTradeWay = document.querySelector(\"#tradeWay\").value;\r\n    if(customerName==\"\"||customerAddress==\"\"||customerPhone==\"\"||customerEmail==\"\"||customerTradeWay==\"\"){\r\n        alert(\"請輸入訂單資訊\")\r\n        return;\r\n    }\r\n\r\n    axios.post(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/orders`,{\r\n        \"data\": {\r\n            \"user\": {\r\n            \"name\": customerName,\r\n            \"tel\": customerPhone,\r\n            \"email\": customerEmail,\r\n            \"address\": customerAddress,\r\n            \"payment\": customerTradeWay\r\n            }\r\n        }\r\n    }).then(res=>{\r\n        alert(\"訂單建立成功\")\r\n        orderForm.reset();\r\n        getCartList();\r\n    })\r\n})\r\n//validate 驗證\r\nconst inputs = document.querySelectorAll(\"input[name],select[data=payment]\");\r\n\r\nconst constraints = {\r\n    \"姓名\": {\r\n      presence: {\r\n        message: \"必填欄位\"\r\n      }\r\n    },\r\n    \"電話\": {\r\n      presence: {\r\n        message: \"必填欄位\"\r\n      },\r\n      length: {\r\n        minimum: 8,\r\n        message: \"需超過 8 碼\"\r\n      }\r\n    },\r\n    \"Email\": {\r\n      presence: {\r\n        message: \"必填欄位\"\r\n      },\r\n      email: {\r\n        message: \"格式錯誤\"\r\n      }\r\n    },\r\n    \"寄送地址\": {\r\n      presence: {\r\n        message: \"必填欄位\"\r\n      }\r\n    },\r\n    \"交易方式\": {\r\n      presence: {\r\n        message: \"必填欄位\"\r\n      }\r\n    },\r\n  };\r\n\r\n  inputs.forEach((item) => {\r\n    item.addEventListener(\"change\", function () {\r\n      \r\n      item.nextElementSibling.textContent = '';\r\n      let errors = validate(orderForm, constraints) || '';\r\n      console.log(errors)\r\n\r\n      if (errors) {\r\n        Object.keys(errors).forEach(function (keys) {\r\n          console.log(document.querySelector(`[data-message=${keys}]`))\r\n          document.querySelector(`[data-message=\"${keys}\"]`).textContent = errors[keys];\r\n        })\r\n      }\r\n    });\r\n  });\r\n\r\n//utillities\r\nfunction　toThousandsComma(num){\r\n    return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n}\r\n"],"file":"index.js"}