{"version":3,"sources":["admin.js"],"names":["menuOpenBtn","document","querySelector","linkBtn","querySelectorAll","menu","addEventListener","menuToggle","forEach","item","closeMenu","classList","contains","remove","add","init","getOrderList","orderListData","orderList","axios","get","api_path","headers","token","then","response","data","orders","renderC3","renderList","str","productStr","productItem","products","title","quantity","orderPaidStatus","paid","thisStamp","Date","createdAt","thisTime","getFullYear","getMonth","getDate","content","id","user","name","tel","address","email","innerHTML","console","log","totalItem","category","price","totalItemC3","Object","entries","chart","c3","generate","bindto","type","columns","colors","e","preventDefault","targetClass","target","getAttribute","Id","dataset","status","completeOrderItem","deleteOrderItem","newStatus","put","res","alert","deleteOrderBtnAll","err"],"mappings":"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","sourcesContent":["// 預設 JS，請同學不要修改此處\r\nlet menuOpenBtn = document.querySelector('.menuToggle');\r\nlet linkBtn = document.querySelectorAll('.topBar-menu a');\r\nlet menu = document.querySelector('.topBar-menu');\r\nmenuOpenBtn.addEventListener('click', menuToggle);\r\n\r\nlinkBtn.forEach((item) => {\r\n    item.addEventListener('click', closeMenu);\r\n})\r\n\r\nfunction menuToggle() {\r\n    if(menu.classList.contains('openMenu')) {\r\n        menu.classList.remove('openMenu');\r\n    }else {\r\n        menu.classList.add('openMenu');\r\n    }\r\n}\r\nfunction closeMenu() {\r\n    menu.classList.remove('openMenu');\r\n}\r\n\r\n\r\n\r\n////後台\r\n//取得訂單資料\r\n\r\nfunction init(){\r\n    getOrderList();\r\n}\r\n\r\ninit();\r\n\r\nlet orderListData = [];\r\nconst orderList = document.querySelector(\".js-orderList\")\r\n\r\nfunction getOrderList() {\r\n    axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\r\n      {\r\n        headers: {\r\n          'Authorization': token\r\n        }\r\n      }).then(function (response) {\r\n        // console.log(response.data);\r\n        orderListData = response.data.orders;\r\n        renderC3();\r\n        renderList(orderListData);\r\n      })\r\n  }\r\n\r\nfunction renderList(data){\r\n    let str = \"\";\r\n    data.forEach(item=>{\r\n      //組訂單商品資訊\r\n      let productStr = \"\";\r\n      let productItem = item.products;\r\n      productItem.forEach(productItem=>{\r\n        productStr+=`<p>${productItem.title}x ${productItem.quantity}</p>`\r\n      })\r\n      //判斷訂單狀態\r\n      let orderPaidStatus = \"\"\r\n      item.paid? orderPaidStatus =`已處理`: orderPaidStatus =`未處理`\r\n      //組時間字串\r\n      const thisStamp = new Date(item.createdAt*1000);\r\n      const thisTime = `${thisStamp.getFullYear()}/${thisStamp.getMonth()+1}/${thisStamp.getDate()}`\r\n    //   console.log(thisTime);\r\n      //組訂單List\r\n      let content = `<tr>\r\n        <td>${item.id}</td>\r\n        <td>\r\n          <p>${item.user.name}</p>\r\n          <p>${item.user.tel}</p>\r\n        </td>\r\n        <td>${item.user.address}</td>\r\n        <td>${item.user.email}</td>\r\n        <td>\r\n          ${productStr}\r\n        </td>\r\n        <td>${thisTime}</td>\r\n        <td class=\"orderStatus\">\r\n          <a href=\"#\" data-id=\"${item.id}\" data-status=\"${item.paid}\" class=\"text-primary js-orderStatus\">${orderPaidStatus}</a>\r\n        </td>\r\n        <td>\r\n          <input type=\"button\" class=\"delSingleOrder-Btn js-orderDelete\" data-id=\"${item.id}\" value=\"刪除\">\r\n        </td>\r\n      </tr>`\r\n      str+=content;\r\n    })\r\n    orderList.innerHTML = str;\r\n  }\r\n  \r\nfunction renderC3(){\r\n    console.log(orderListData)\r\n    let totalItem ={};\r\n    orderListData.forEach(item=>{\r\n        item.products.forEach(products=>{\r\n            if(!totalItem[products.category]){\r\n                totalItem[products.category] = products.price*products.quantity;\r\n            }else{\r\n                totalItem[products.category] += products.price*products.quantity;\r\n            }\r\n        })\r\n    })\r\n    // console.log(totalItem)\r\n    let totalItemC3 = Object.entries(totalItem);\r\n    // console.log(totalItemC3)\r\n    // C3.js\r\n    let chart = c3.generate({\r\n        bindto: '#chart', // HTML 元素綁定\r\n        data: {\r\n            type: \"pie\",\r\n            columns: totalItemC3,\r\n            colors:{\r\n                \"床架\":\"#DACBFF\",\r\n                \"收納\":\"#9D7FEA\",\r\n                \"窗簾\": \"#5434A7\",\r\n                \"其他\": \"#301E5F\",\r\n            }\r\n        },\r\n    });\r\n}\r\n\r\norderList.addEventListener('click',(e)=>{\r\n    e.preventDefault();\r\n    const targetClass = e.target.getAttribute(\"class\");\r\n    // console.log(targetClass);\r\n    let Id = e.target.dataset.id;\r\n    if(targetClass ==\"text-primary js-orderStatus\") {\r\n      // console.log(e.target.dataset.status);\r\n      let status = e.target.dataset.status;\r\n      completeOrderItem(status,Id);\r\n      return\r\n    }\r\n    if(targetClass ==\"delSingleOrder-Btn js-orderDelete\") {\r\n    //   console.log(e.target.dataset.id);\r\n      deleteOrderItem(Id);\r\n      return\r\n    }\r\n  })\r\n  \r\nfunction completeOrderItem(status,Id) {\r\n    // console.log(status,Id);\r\n    let newStatus;\r\n    // if(!status){\r\n    //     newStatus = false\r\n    // }else{\r\n    //     newStatus = true\r\n    // }\r\n    !status? newStatus = false:newStatus = true;\r\n    console.log(newStatus);\r\n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,{\r\n      \"data\": {\r\n        \"id\": Id,\r\n        \"paid\": newStatus\r\n      }\r\n    }, {\r\n      headers: {\r\n        'Authorization': token\r\n      }\r\n    })\r\n    .then(res=>{\r\n      alert(\"修改訂單成功\")\r\n      getOrderList();\r\n    })\r\n}  \r\n\r\nfunction deleteOrderItem(Id){\r\n    // console.log(Id);\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${Id}`,\r\n      {\r\n        headers: {\r\n          'Authorization': token\r\n        }\r\n      }).then(res=>{\r\n        alert(\"刪除完畢\")\r\n        getOrderList();\r\n      })\r\n}\r\n\r\nconst deleteOrderBtnAll = document.querySelector(\".discardAllBtn\");\r\n\r\ndeleteOrderBtnAll.addEventListener(\"click\",(e)=>{\r\n    e.preventDefault();\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\r\n      {\r\n        headers: {\r\n          'Authorization': token\r\n        }\r\n      }).then(res=>{\r\n        alert(\"已全部刪除\");\r\n        getOrderList();\r\n      }).catch(err=>{\r\n        alert(\"請勿重複按取\")\r\n        getOrderList();\r\n      })\r\n});"],"file":"admin.js"}