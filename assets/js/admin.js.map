{"version":3,"sources":["admin.js"],"names":["menuOpenBtn","document","querySelector","linkBtn","querySelectorAll","menu","addEventListener","menuToggle","forEach","item","closeMenu","classList","contains","remove","add","init","getOrderList","orderListData","orderList","axios","get","api_path","headers","token","then","response","data","orders","renderC3","console","log","renderList","str","productStr","productItem","products","title","quantity","orderPaidStatus","paid","thisStamp","Date","createdAt","thisTime","getFullYear","getMonth","getDate","content","id","user","name","tel","address","email","innerHTML","totalItem","price","totalItemC3","Object","entries","otherItem","filter","index","otherItemTotal","reduce","prev","curr","splice","length","newOtherTotalC3","sort","a","b","chart","c3","generate","bindto","type","columns","color","pattern","e","preventDefault","targetClass","target","getAttribute","Id","dataset","status","completeOrderItem","deleteOrderItem","newStatus","put","res","alert","deleteOrderBtnAll","err"],"mappings":"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","sourcesContent":["// 預設 JS，請同學不要修改此處\r\nlet menuOpenBtn = document.querySelector('.menuToggle');\r\nlet linkBtn = document.querySelectorAll('.topBar-menu a');\r\nlet menu = document.querySelector('.topBar-menu');\r\nmenuOpenBtn.addEventListener('click', menuToggle);\r\n\r\nlinkBtn.forEach((item) => {\r\n    item.addEventListener('click', closeMenu);\r\n})\r\n\r\nfunction menuToggle() {\r\n    if(menu.classList.contains('openMenu')) {\r\n        menu.classList.remove('openMenu');\r\n    }else {\r\n        menu.classList.add('openMenu');\r\n    }\r\n}\r\nfunction closeMenu() {\r\n    menu.classList.remove('openMenu');\r\n}\r\n\r\n////後台\r\n//取得訂單資料\r\n\r\nfunction init(){\r\n    getOrderList();\r\n}\r\n\r\ninit();\r\n\r\nlet orderListData = [];\r\nconst orderList = document.querySelector(\".js-orderList\")\r\n\r\nfunction getOrderList() {\r\n    axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\r\n      {\r\n        headers: {\r\n          'Authorization': token\r\n        }\r\n      }).then(function (response) {\r\n        // console.log(response.data);\r\n        orderListData = response.data.orders;\r\n        renderC3();\r\n        console.log(orderListData);\r\n        renderList(orderListData);\r\n      })\r\n  }\r\n\r\nfunction renderList(data){\r\n    let str = \"\";\r\n\r\n    data.forEach(item=>{\r\n      //組訂單商品資訊\r\n      let productStr = \"\";\r\n      let productItem = item.products;\r\n      productItem.forEach(productItem=>{\r\n        productStr+=`<p>${productItem.title}x ${productItem.quantity}</p>`\r\n      })\r\n      //判斷訂單狀態\r\n      let orderPaidStatus = \"\"\r\n      item.paid? orderPaidStatus =`已處理`: orderPaidStatus =`未處理`\r\n      //組時間字串\r\n      const thisStamp = new Date(item.createdAt*1000);\r\n      const thisTime = `${thisStamp.getFullYear()}/${thisStamp.getMonth()+1}/${thisStamp.getDate()}`\r\n    //   console.log(thisTime);\r\n      //組訂單List\r\n      let content = `<tr>\r\n        <td>${item.id}</td>\r\n        <td>\r\n          <p>${item.user.name}</p>\r\n          <p>${item.user.tel}</p>\r\n        </td>\r\n        <td>${item.user.address}</td>\r\n        <td>${item.user.email}</td>\r\n        <td>\r\n          ${productStr}\r\n        </td>\r\n        <td>${thisTime}</td>\r\n        <td class=\"orderStatus\">\r\n          <a href=\"#\" data-id=\"${item.id}\" data-status=\"${item.paid}\" class=\"text-primary js-orderStatus\">${orderPaidStatus}</a>\r\n        </td>\r\n        <td>\r\n          <input type=\"button\" class=\"delSingleOrder-Btn js-orderDelete\" data-id=\"${item.id}\" value=\"刪除\">\r\n        </td>\r\n      </tr>`\r\n      str+=content;\r\n    })\r\n    orderList.innerHTML = str;\r\n  }\r\n  \r\nfunction renderC3(){\r\n    console.log(orderListData)\r\n    let totalItem ={};\r\n    orderListData.forEach(item=>{\r\n        item.products.forEach(products=>{\r\n            if(!totalItem[products.title]){\r\n                totalItem[products.title] = products.price*products.quantity;\r\n            }else{\r\n                totalItem[products.title] += products.price*products.quantity;\r\n            }\r\n        })\r\n    })\r\n    // console.log(totalItem)\r\n\r\n    //改成C3格式\r\n    let totalItemC3 = Object.entries(totalItem);\r\n    \r\n    // console.log(totalItemC3)\r\n    //整合其他內容\r\n    \r\n    let otherItem = totalItemC3.filter((item,index)=>{\r\n        return index>2\r\n    })\r\n\r\n    let otherItemTotal = otherItem.reduce((prev,curr)=>{\r\n        return [[`其他`,prev[1]+curr[1]]]\r\n    })\r\n    // console.log(otherItemTotal);\r\n    totalItemC3.splice(3,totalItemC3.length-1)\r\n    \r\n    let newOtherTotalC3 = [...totalItemC3,...otherItemTotal];\r\n    newOtherTotalC3.sort((a,b)=>{\r\n        return a[1]-b[1]\r\n    })\r\n    // console.log(newOtherTotalC3);\r\n    \r\n    // C3.js\r\n    let chart = c3.generate({\r\n        bindto: '#chart', // HTML 元素綁定\r\n        data: {\r\n            type: \"pie\",\r\n            columns: newOtherTotalC3,\r\n        },\r\n        color:{ \r\n            pattern: [\"#DACBFF\",\"#9D7FEA\",\"#5434A7\",\"#301E5F\"]\r\n        }\r\n    });\r\n}\r\n\r\norderList.addEventListener('click',(e)=>{\r\n    e.preventDefault();\r\n    const targetClass = e.target.getAttribute(\"class\");\r\n    // console.log(targetClass);\r\n    let Id = e.target.dataset.id;\r\n    if(targetClass ==\"text-primary js-orderStatus\") {\r\n      // console.log(e.target.dataset.status);\r\n      let status = e.target.dataset.status;\r\n      completeOrderItem(status,Id);\r\n      return\r\n    }\r\n    if(targetClass ==\"delSingleOrder-Btn js-orderDelete\") {\r\n    //   console.log(e.target.dataset.id);\r\n      deleteOrderItem(Id);\r\n      return\r\n    }\r\n  })\r\n  \r\nfunction completeOrderItem(status,Id) {\r\n    // console.log(status,Id);\r\n    let newStatus;\r\n    // if(!status){\r\n    //     newStatus = false\r\n    // }else{\r\n    //     newStatus = true\r\n    // }\r\n    !status? newStatus = false:newStatus = true;\r\n    console.log(newStatus);\r\n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,{\r\n      \"data\": {\r\n        \"id\": Id,\r\n        \"paid\": newStatus\r\n      }\r\n    }, {\r\n      headers: {\r\n        'Authorization': token\r\n      }\r\n    })\r\n    .then(res=>{\r\n      alert(\"修改訂單成功\")\r\n      getOrderList();\r\n    })\r\n}  \r\n\r\nfunction deleteOrderItem(Id){\r\n    // console.log(Id);\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${Id}`,\r\n      {\r\n        headers: {\r\n          'Authorization': token\r\n        }\r\n      }).then(res=>{\r\n        alert(\"刪除完畢\")\r\n        getOrderList();\r\n      })\r\n}\r\n\r\nconst deleteOrderBtnAll = document.querySelector(\".discardAllBtn\");\r\n\r\ndeleteOrderBtnAll.addEventListener(\"click\",(e)=>{\r\n    e.preventDefault();\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\r\n      {\r\n        headers: {\r\n          'Authorization': token\r\n        }\r\n      }).then(res=>{\r\n        alert(\"已全部刪除\");\r\n        getOrderList();\r\n      }).catch(err=>{\r\n        alert(\"請勿重複按取\")\r\n        getOrderList();\r\n      })\r\n});"],"file":"admin.js"}